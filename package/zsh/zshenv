#
# Global environment
#

export PATH="${HOME}/.dotfiles/bin:${PATH}"
export EDITOR=vim
export VISUAL=vim
export XDG_DATA_DIRS="${HOME}/.nix-profile/share:${XDG_DATA_DIRS}"

# Make locales work with Nix.
export LOCALE_ARCHIVE="$(readlink ~/.nix-profile/lib/locale)/locale-archive"

# Fix Java version.
JAVA_HOME="$(readlink ~/.nix-profile)/lib/openjdk"

# Pin nixpkgs.
export AN_NIXPKGS="https://github.com/NixOS/nixpkgs/archive/53bd44342d22b53677b245c15de6e8f8a37718d0.tar.gz"
# NIX_PATH gets overridden by Nix's site-wide profile, which is sourced from
# '/etc/profile', which is sourced from 'zprofile'. For mitigation, see the
# 'nix-env' alias below.
# export NIX_PATH="an_nixpkgs=${AN_NIXPKGS}"

#
# App-specific environments
#

# firefox: Enable touch screen scrolling.
if command -v firefox &> /dev/null; then
    alias firefox='MOZ_USE_XINPUT2=1 firefox'
fi

# xournalpp: Dark theme.
if command -v xournalpp &> /dev/null; then
    alias xournalpp='GTK_THEME=Adwaita:dark xournalpp'
fi

# maven: Fix Java version.
if command -v mvn &> /dev/null; then
    alias mvn='JAVA_HOME=${JAVA_HOME} mvn'
    alias mvnDebug='JAVA_HOME=${JAVA_HOME} mvnDebug'
fi

# Nix
if command -v nix-env &> /dev/null; then
    alias nix-env-defexpr=$(which nix-env)
    # Yes, it is probably redundant to have both -I and -f.
    alias nix-env='nix-env -I an_nixpkgs=${AN_NIXPKGS} -f ${AN_NIXPKGS}'
fi


# FIXME TODO This is actually killing me.
# This should NOT go here, but it doesn't work anywhere else. Something very
# late in the login process is overwritting this setting.
# /usr/bin/setxkbmap -option caps:ctrl_modifier


# qutebrowser
# Temporary fix until bug with xcb_gl integration gets fixed (not sure whether
# problem with Nix or qutebrowser.
if command -v qutebrowser &> /dev/null; then
    alias qutebrowser='QT_XCB_GL_INTEGRATION=none qutebrowser'
fi
