#!/bin/bash

_this_path=$(readlink -f "${0}")

_command="${1}"
_arg="${2}"

_get_bar_mode() {
    i3-msg -t get_bar_config bar-0 | jq -r .mode
}

_old_bar_mode=$(_get_bar_mode)

case ${_command} in
    _pre_lock_hook)
        ${0} notify_pause && i3-msg bar mode invisible
        ;;
    lock)
        # TODO: Figure out how to correctly integrate i3lock with xss-lock and
        # with pre, post hooks.
        i3lock -dI 10 -ti "${HOME}/.wallpaperlock"
        ;;
    _post_lock_hook)
        i3-msg bar mode "${_arg}" && ${0} notify_resume
        ;;
    exit)
        i3-nagbar -t warning -m 'Exit i3wm?' -b 'Yeah.' 'i3-msg exit'
        ;;
    shutdown)
        i3-nagbar -t warning -m 'Shutdown?' -b 'Yeah.' 'shutdown now'
        ;;
    reboot)
        i3-nagbar -t warning -m 'Reboot?' -b 'Yeah.' 'shutdown -r now'
        ;;
    hibernate)
        i3-input -F "exec ${_this_path} _hibernate %s" -P "hibernate? [yN] "
        ;;
    _hibernate)
        test "${_arg}" = y && ${_this_path} lock && sudo /usr/sbin/pm-hibernate
        ;;
    reload)
        i3-msg reload
        ;;
    restart)
        i3-msg restart
        ;;
    notify_pause)
        killall -SIGUSR1 dunst
        ;;
    notify_resume)
        killall -SIGUSR2 dunst
        ;;
    *)
        exit -1
        ;;
esac
